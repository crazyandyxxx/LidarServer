var map,object3Dlayer,animData,lines,points3D,pie,currentDate,positionLabel,vMax=1e4,vMin=0,animI=0,playSpeed=1e3,canBeStop=!1,rdata={},rangeMax=6e3,colorOpacity=.5,resolution=15,horAng=0,verAngStart=0,verAngEnd=360,verAngStep=5,longitude=0,latitude=0,altitude=0,drawData=[],timeat=[],height=[],verAngles=[],position=new AMap.LngLat(0,0),hoverAdd=!1,rotationAngle=0,isPlaying=!1,channelID="prr_A",drawName=document.getElementById("channel").options[0].text,layoutA={xaxis:{title:"时间",showline:!0,tickmode:"auto",range:[],showspikes:!0,spikemode:"across"},yaxis:{title:"距离(km)",showline:!0,range:[0,rangeMax/1e3]},paper_bgcolor:"transparent",plot_bgcolor:"transparent",margin:{t:30,l:60,b:57}},layoutLineA={xaxis:{title:"强度",showline:!0,tickmode:"auto",showexponent:"last",exponentformat:"power"},yaxis:{showline:!0,range:[0,rangeMax/1e3],ticks:"outside"},annotations:[{showarrow:!1,text:"",font:{color:"black"},xref:"paper",yref:"paper",x:.5,y:.5}],paper_bgcolor:"transparent",plot_bgcolor:"transparent",margin:{t:30,l:25,r:40,b:57}},layoutConfig={displayModeBar:!1,responsive:!0},PRA_data={},traceA={},lineIndex=0,plotA=document.getElementById("PRADiv"),rc=15e3,sa=40,snrT=2,pblT=.5,pa=243,pb=1.13,pc=.5,zoomLevel=13;function setMapCenter(){map.setZoomAndCenter(zoomLevel,position)}function saveMap(){html2canvas(document.getElementById("viewDiv")).then((function(e){e.toBlob((function(e){var t=document.createElement("a");if(void 0!==t.download){var a=URL.createObjectURL(e),n=document.getElementById("channel"),r=document.getElementById("timeSeries");t.setAttribute("href",a),t.setAttribute("download","垂直切面截图_"+n.options[n.selectedIndex].text+"_"+r.options[r.selectedIndex].text+".png"),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}))}))}function setDateRange(e,t){$('input[name="dates"]').daterangepicker({singleDatePicker:!0,startDate:t,endDate:t,minDate:e,maxDate:t,locale:{format:"YYYY/MM/DD",applyLabel:"确定",cancelLabel:"取消",fromLabel:"从",toLabel:"至",customRangeLabel:"Custom",weekLabel:"周",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1}},(function(e,t){$.post(urlGetRhiData,{"task id":task_id,content:"list","time start":e.format("YYYY-MM-DD")+" 00:00:00","time end":e.format("YYYY-MM-DD")+" 24:00:00"},(function(t,a){currentDate=e.format("YYYY-MM-DD");var n=document.getElementById("timeSeries");n.options.length=0;for(let e=0;e<t.result.length;e++)n.options.add(new Option(t.result[e].timestamp+""));SelectTime()}))}))}function plotHover(e){var t="";for(let a=0;a<e.points.length;a++)"heatmap"===e.points[a].fullData.type&&(t=e.points[a].pointNumber);lineIndex=t[1];let a=rangeMax/map.getResolution(position,20),n=a*Math.sin((verAngStart+lineIndex*verAngStep)/180*Math.PI),r=a*Math.cos((verAngStart+lineIndex*verAngStep)/180*Math.PI)*Math.sin(horAng/180*Math.PI),o=-a*Math.cos((verAngStart+lineIndex*verAngStep)/180*Math.PI)*Math.cos(horAng/180*Math.PI);lines.geometry.vertices.splice(3,3,r,o,-n),lines.needUpdate=!0,points3D.geometry.vertices.splice(3,3,r,o,-n),points3D.needUpdate=!0,lines.reDraw(),points3D.reDraw(),hoverAdd||(object3Dlayer.add(lines),object3Dlayer.add(points3D),hoverAdd=!0),traceA.x=drawData[lineIndex].slice(layoutLineA.yaxis.range[0]/resolution*1e3,layoutLineA.yaxis.range[1]/resolution*1e3),traceA.y=height.slice(layoutLineA.yaxis.range[0]/resolution*1e3,layoutLineA.yaxis.range[1]/resolution*1e3),layoutLineA.annotations[0].text=timeat[lineIndex],Plotly.react("lineADiv",[traceA],layoutLineA);let i=map.lngLatToGeodeticCoord(position),l=new AMap.Pixel(i.x+r,i.y+o),s=map.geodeticCoordToLngLat(l);positionLabel.setText((verAngStart+lineIndex*verAngStep).toString()),positionLabel.setHeight(n),positionLabel.setPosition(s),positionLabel.show()}function plotUnHover(e){object3Dlayer.remove(lines),object3Dlayer.remove(points3D),hoverAdd=!1,positionLabel.hide()}function createPieIndicator(){var e=(lines=new AMap.Object3D.Line).geometry;(points3D=new AMap.Object3D.RoundPoints).transparent=!0;var t=points3D.geometry;let a=rangeMax/map.getResolution(position,20),n=a*Math.sin((verAngStart+lineIndex*verAngStep)/180*Math.PI),r=a*Math.cos((verAngStart+lineIndex*verAngStep)/180*Math.PI)*Math.sin(horAng/180*Math.PI),o=-a*Math.cos((verAngStart+lineIndex*verAngStep)/180*Math.PI)*Math.cos(horAng/180*Math.PI);e.vertices.push(0,0,0),e.vertexColors.push(0,1,1,1),e.vertices.push(r,o,-n),e.vertexColors.push(0,1,1,1),t.vertices.push(0,0,0),t.pointSizes.push(8),t.vertexColors.push(0,0,1,1),t.vertices.push(r,o,-n),t.pointSizes.push(16),t.vertexColors.push(.058,.03,.02,1),points3D.borderColor=[.4,.8,1,1],points3D.borderWeight=3,lines.rotateZ(rotationAngle),points3D.rotateZ(rotationAngle),lines.position(position),points3D.position(position)}function createPie(e,t,a,n,r,o,i,l,s,d,c){var p=Math.floor((i-o)/l);(pie=new AMap.Object3D.Mesh).transparent=!0,pie.backOrFront="both";for(var g=pie.geometry,u=0;u<p;u++)generateTriangle(g,e,n,a,u,t,r,o+u*l,o+(u+1)*l,s,d,c);pie.rotateZ(rotationAngle),pie.position(e),object3Dlayer.add(pie)}function generateTriangle(e,t,a,n,r,o,i,l,s,d,c,p){var g=[],u=[],m=[],v=[],h=[],y=[],A=a/n;n/=map.getResolution(t,20);map.getResolution(t,20);for(let e=0;e<A+1;e++){g.push(0+e*n*Math.cos(l/180*Math.PI)*Math.sin(i/180*Math.PI)),u.push(0-e*n*Math.cos(l/180*Math.PI)*Math.cos(i/180*Math.PI));var x=0-e*n*Math.sin(l/180*Math.PI);m.push(x),v.push(0+e*n*Math.cos(s/180*Math.PI)*Math.sin(i/180*Math.PI)),h.push(0-e*n*Math.cos(s/180*Math.PI)*Math.cos(i/180*Math.PI));var M=0-e*n*Math.sin(s/180*Math.PI);y.push(M)}for(let t=0;t<A;t++)if(e.vertices.push(g[t],u[t],m[t]),e.vertices.push(g[t+1],u[t+1],m[t+1]),e.vertices.push(v[t+1],h[t+1],y[t+1]),e.vertices.push(g[t],u[t],m[t]),e.vertices.push(v[t],h[t],y[t]),e.vertices.push(v[t+1],h[t+1],y[t+1]),r<o.length-1){var D=getColor(o[r][t],d,c,p),I=getColor(o[r][t+1],d,c,p),w=getColor(o[r+1][t],d,c,p),b=getColor(o[r+1][t+1],d,c,p);e.vertexColors.push(D.r,D.g,D.b,D.a),e.vertexColors.push(I.r,I.g,I.b,I.a),e.vertexColors.push(b.r,b.g,b.b,b.a),e.vertexColors.push(D.r,D.g,D.b,D.a),e.vertexColors.push(w.r,w.g,w.b,w.a),e.vertexColors.push(b.r,b.g,b.b,b.a)}else e.vertexColors.push(0,0,0,0),e.vertexColors.push(0,0,0,0),e.vertexColors.push(0,0,0,0),e.vertexColors.push(0,0,0,0),e.vertexColors.push(0,0,0,0),e.vertexColors.push(0,0,0,0)}function prepareData(e){rdata.raw_A=[],rdata.raw_B=[],rdata.prr_A=[],rdata.prr_B=[],rdata.ext=[],rdata.dep=[],rdata.pm10=[],rdata.pm25=[],timeat=[],verAngles=[],resolution=e.result[0].resolution,height=[],res=resolution/1e3;var t=e.result[0].raw_A.length;for(let e=0;e<t;e++)height.push((e+1)*res);horAng=e.result[0].horAngle,verAngStart=e.result[0].verAngle,verAngEnd=e.result[e.result.length-1].verAngle,verAngStep=e.result.length-1>0?e.result[1].verAngle-e.result[0].verAngle:0;let a=[],n=[],r=[];for(let t=0;t<e.result.length;t++)e.result[t].longitude>0&&(a.push(e.result[t].longitude),n.push(e.result[t].latitude),r.push(e.result[t].altitude));a.sort((function(e,t){return e-t})),n.sort((function(e,t){return e-t})),r.sort((function(e,t){return e-t})),longitude=a[Math.floor(a.length/2)],latitude=n[Math.floor(a.length/2)],altitude=r[Math.floor(a.length/2)],position=Gps84ToGcj02(longitude,latitude);for(let t=0;t<e.result.length;t++)timeat.push(e.result[t].timestamp),verAngles.push(verAngStart+t*verAngStep),rdata.prr_A.push(e.result[t].prr_A),rdata.prr_B.push(e.result[t].prr_B),rdata.raw_A.push(e.result[t].raw_A),rdata.raw_B.push(e.result[t].raw_B),rdata.ext.push(e.result[t].ext),rdata.dep.push(e.result[t].dep),rdata.pm10.push(e.result[t].ext.map(e=>e>0?pa*Math.pow(e,pb):0)),rdata.pm25.push(e.result[t].ext.map(e=>e>0?pc*pa*Math.pow(e,pb):0))}function addMapEvents(){document.getElementById("timeSeries").addEventListener("change",SelectTime),document.getElementById("channel").addEventListener("change",SelectChannel),document.getElementById("colorMax").addEventListener("change",ChangeMaxValue),document.getElementById("colorMin").addEventListener("change",ChangeMinValue),document.getElementById("zMax").addEventListener("change",ChangeRangeMax),document.getElementById("zMin").addEventListener("change",ChangeRangeMin),document.getElementById("opacity").addEventListener("change",ChangeColorOpacity),document.getElementById("rotation").addEventListener("change",ChangeRotationAngle),document.getElementById("curvePlay").addEventListener("click",playHeatmap),document.getElementById("setCenter").addEventListener("click",setMapCenter),document.getElementById("saveMap").addEventListener("click",saveMap),document.getElementById("closeHeat").addEventListener("click",CloseHeatMap),document.getElementById("showHeat").addEventListener("click",ShowHeatMap),document.getElementById("savePicA").addEventListener("click",SaveHeatA),document.getElementById("saveLineA").addEventListener("click",SaveLineA),document.getElementById("realTime").addEventListener("click",getRealTimeData),document.getElementById("reCalc").addEventListener("click",ReCalculation),document.getElementById("showRecalc").addEventListener("click",ShowRecalc)}function ShowRecalc(){isPlaying||$("#calcModal").modal("show")}function ReCalculation(){$("#calcModal").modal("hide"),rc=$("#rc").val(),sa=$("#sa").val(),snrT=$("#snrT").val(),pblT=$("#pblT").val(),pa=$("#pa").val(),pb=$("#pb").val(),pc=$("#pc").val();var e=document.getElementById("timeSeries"),t=e.selectedIndex;$.ajax({type:"post",data:{"task id":task_id,content:"timedata",time:e.options[t].text,"calc param":`{"rc": ${rc}, "sa": ${sa}, "snrT": ${snrT}, "pblT": ${pblT} }`},url:urlGetRhiData,beforeSend:function(){$("#myLoading").modal("show")},success:function(e){$("#myLoading").modal("hide"),prepareData(e),SelectChannel()}})}function getRealTimeData(){document.getElementById("realTime").checked&&$.post(urlGetRhiData,{"task id":task_id,content:"dates"},(function(e,t){currentDate=e.result[0].dateEnd,setDateRange(e.result[0].dateStart,e.result[0].dateEnd),$.post(urlGetRhiData,{"task id":task_id,content:"list","time start":e.result[0].dateEnd+" 00:00:00","time end":e.result[0].dateEnd+" 24:00:00"},(function(e,t){if(isPlaying)setTimeout(getRealTimeData,1e4);else{var a=document.getElementById("timeSeries");a.options.length=0;for(let t=0;t<e.result.length;t++)a.options.add(new Option(e.result[t].timestamp+""));a.selectedIndex=0,$.ajax({type:"post",data:{"task id":task_id,content:"timedata",time:currentDate+" "+a.options[0].text,"calc param":`{"rc": ${rc}, "sa": ${sa}, "snrT": ${snrT}, "pblT": ${pblT} }`},url:urlGetRhiData,success:function(e){if(prepareData(e),showHeat){lineIndex=e.result.length-1,layoutLineA.annotations[0].text=timeat[lineIndex],plotA.removeListener("plotly_hover",plotHover);var t={"xaxis.range[0]":timeat[0],"xaxis.range[1]":timeat[timeat.length-1]};Plotly.relayout("PRADiv",t)}SelectChannel(),showHeat&&plotA.on("plotly_hover",plotHover),document.getElementById("angleRange").textContent="扫描范围"+verAngStart+" - "+verAngEnd,document.getElementById("angleStep").textContent="扫描步长"+verAngStep,document.getElementById("angleVer").textContent="水平角度"+horAng,document.getElementById("timeStamp").textContent=timeat[0]+"至"+timeat[timeat.length-1],setTimeout(getRealTimeData,1e4)}})}}))}))}function SelectTime(){if(!isPlaying){var e=document.getElementById("timeSeries"),t=e.selectedIndex;$.ajax({type:"post",data:{"task id":task_id,content:"timedata",time:currentDate+" "+e.options[t].text,"calc param":`{"rc": ${rc}, "sa": ${sa}, "snrT": ${snrT}, "pblT": ${pblT} }`},url:urlGetRhiData,beforeSend:function(){$("#myLoading").modal("show")},success:function(e){$("#myLoading").modal("hide"),prepareData(e),lineIndex=0,plotA.removeListener("plotly_hover",plotHover);var t={"xaxis.range[0]":timeat[0],"xaxis.range[1]":timeat[timeat.length-1]};Plotly.relayout("PRADiv",t),SelectChannel(),plotA.on("plotly_hover",plotHover),document.getElementById("angleRange").textContent="扫描范围"+verAngStart+" - "+verAngEnd,document.getElementById("angleStep").textContent="扫描步长"+verAngStep,document.getElementById("angleVer").textContent="水平角度"+horAng,document.getElementById("timeStamp").textContent=timeat[0]+"至"+timeat[timeat.length-1]}})}}function SelectChannel(){if(!isPlaying){var e=document.getElementById("channel");switch(drawData=rdata.prr_A,channelID=e.options[e.selectedIndex].value,drawName=e.options[e.selectedIndex].text,channelID){case"prr_A":drawData=rdata.prr_A;break;case"prr_B":drawData=rdata.prr_B;break;case"ext":drawData=rdata.ext;break;case"dep":drawData=rdata.dep;break;case"raw_A":drawData=rdata.raw_A;break;case"raw_B":drawData=rdata.raw_B;break;case"pm10":drawData=rdata.pm10;break;case"pm25":drawData=rdata.pm25}object3Dlayer.clear(),createPie(position,drawData,resolution,rangeMax,horAng,verAngStart,verAngEnd,verAngStep,vMin,vMax,colorOpacity),createPieIndicator(),PRA_data.x=timeat,PRA_data.z=drawData,PRA_data.text=verAngles,traceA.x=drawData[lineIndex].slice(layoutLineA.yaxis.range[0]/resolution*1e3,layoutLineA.yaxis.range[1]/resolution*1e3),Plotly.react("PRADiv",[PRA_data],layoutA),Plotly.react("lineADiv",[traceA],layoutLineA)}}function ChangeMaxValue(e){if(!isPlaying){var t=e.target;vMax=Number(t.value),object3Dlayer.clear(),createPie(position,drawData,resolution,rangeMax,horAng,verAngStart,verAngEnd,verAngStep,vMin,vMax,colorOpacity),createPieIndicator(),drawTickText();var a={zmax:vMax};Plotly.restyle("PRADiv",a)}}function ChangeMinValue(e){if(!isPlaying){var t=e.target;vMin=Number(t.value),object3Dlayer.clear(),createPie(position,drawData,resolution,rangeMax,horAng,verAngStart,verAngEnd,verAngStep,vMin,vMax,colorOpacity),createPieIndicator(),drawTickText();var a={zmin:vMin};Plotly.restyle("PRADiv",a)}}function ChangeRangeMax(e){if(!isPlaying){var t=e.target;rangeMax=Number(t.value),object3Dlayer.clear(),createPie(position,drawData,resolution,rangeMax,horAng,verAngStart,verAngEnd,verAngStep,vMin,vMax,colorOpacity),createPieIndicator(),layoutA.yaxis.range[1]=rangeMax/1e3,layoutLineA.yaxis.range[1]=rangeMax/1e3;var a={"yaxis.range[1]":rangeMax/1e3};Plotly.relayout("PRADiv",a),traceA.x=drawData[lineIndex].slice(layoutLineA.yaxis.range[0]/resolution*1e3,layoutLineA.yaxis.range[1]/resolution*1e3),traceA.y=height.slice(layoutLineA.yaxis.range[0]/resolution*1e3,layoutLineA.yaxis.range[1]/resolution*1e3),Plotly.react("lineADiv",[traceA],layoutLineA)}}function ChangeRangeMin(){var e=document.getElementById("zMin");rangeMin=Number(e.value),layoutA.yaxis.range[0]=rangeMin/1e3,layoutLineA.yaxis.range[0]=rangeMin/1e3;var t={"yaxis.range[0]":rangeMin/1e3};Plotly.relayout("PRADiv",t),traceA.x=drawData[lineIndex].slice(layoutLineA.yaxis.range[0]/resolution*1e3,layoutLineA.yaxis.range[1]/resolution*1e3),traceA.y=height.slice(layoutLineA.yaxis.range[0]/resolution*1e3,layoutLineA.yaxis.range[1]/resolution*1e3),Plotly.react("lineADiv",[traceA],layoutLineA)}function ChangeColorOpacity(e){if(!isPlaying){var t=e.target;colorOpacity=Number(t.value),object3Dlayer.clear(),createPie(position,drawData,resolution,rangeMax,horAng,verAngStart,verAngEnd,verAngStep,vMin,vMax,colorOpacity),createPieIndicator()}}function ChangeRotationAngle(e){if(!isPlaying){var t=e.target;rotationAngle=Number(t.value),object3Dlayer.clear(),createPie(position,drawData,resolution,rangeMax,horAng,verAngStart,verAngEnd,verAngStep,vMin,vMax,colorOpacity),createPieIndicator()}}function playHeatmap(e){var t=e.target;isPlaying?canBeStop&&(isPlaying=!1,t.src="../static/play.svg",t.title="播放",document.getElementById("playSpeed").style.display="none"):(document.getElementById("playSpeed").style.display="block",getAnimationData())}function getAnimationData(){$.ajax({type:"post",data:{"task id":task_id,content:"all",channel:channelID,range:rangeMax,"calc param":`{"rc": ${rc}, "sa": ${sa}, "snrT": ${snrT}, "pblT": ${pblT} }`},url:urlGetRhiData,beforeSend:function(){isPlaying=!0,canBeStop=!1,$("#myLoading").modal("show")},success:function(e){var t=document.getElementById("curvePlay");$("#myLoading").modal("hide"),t.src="../static/stop.svg",t.title="停止",canBeStop=!0,animData=e,Scan()}})}async function Scan(){isPlaying&&(animI%=animData.result.length,verAngStart=animData.result[animI].verStartAng,verAngEnd=animData.result[animI].verEndAng,verAngStep=animData.result[animI].verAngStep,object3Dlayer.clear(),createPie(position,animData.result[animI].channeldata,resolution,rangeMax,horAng,verAngStart,verAngEnd,verAngStep,vMin,vMax,colorOpacity),document.getElementById("timeStamp").textContent=animData.result[animI].starttime+"至"+animData.result[animI].endtime,document.getElementById("angleRange").textContent="扫描范围"+verAngStart+" - "+verAngEnd,animI++,await sleep(playSpeed),AMap.Util.requestAnimFrame(Scan))}function sleep(e){return new Promise(t=>setTimeout(t,e))}function SaveHeatA(){Plotly.downloadImage("PRADiv",{format:"png",width:1e3,height:500,filename:"垂直切面_"+drawName+"从"+timeat[0]+"至"+timeat[timeat.length-1]})}function SaveLineA(){let e="";e+="Data Length,"+drawData[lineIndex].length+"\r\n",e+="Resolution,"+resolution+"\r\n",e+=drawData[lineIndex].join(",")+"\r\n";var t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"垂直切面_"+drawName+timeat[lineIndex]+".csv");else{var a=document.createElement("a");if(void 0!==a.download){var n=URL.createObjectURL(t);a.setAttribute("href",n),a.setAttribute("download","垂直切面_"+drawName+"_"+timeat[lineIndex]+".csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}}window.onload=function(){drawColorbar(11),drawTicks(),drawTickText(),map=new AMap.Map("viewDiv",{viewMode:"3D",expandZoomRange:!0,zooms:[3,20],zoom:zoomLevel,pitch:60,center:[116.396132,39.900444]}),positionLabel=new AMap.Text({map:map}),$('[data-toggle="tooltip"]').tooltip(),object3Dlayer=new AMap.Object3DLayer,map.add(object3Dlayer),AMapUI.loadUI(["control/BasicControl"],(function(e){var t=new e.LayerSwitcher({position:"rt",baseLayers:[{enable:!0,id:"Atile",name:"高德矢量图",layer:new AMap.TileLayer},{id:"Asatellite",name:"高德卫星图",layer:new AMap.TileLayer.Satellite},{id:"Gtile",name:"谷歌矢量图",layer:new AMap.TileLayer({getTileUrl:"http://mt{1,2,3,0}.google.cn/vt/lyrs=m@126&hl=zh-CN&gl=cn&src=app&s=G&x=[x]&y=[y]&z=[z]",zIndex:2})},{id:"Gsatellite",name:"谷歌卫星图",layer:new AMap.TileLayer({getTileUrl:"http://mt{1,2,3,0}.google.cn/vt/lyrs=y@126&hl=zh-CN&gl=cn&src=app&s=G&x=[x]&y=[y]&z=[z]",zIndex:2})}],overlayLayers:[{id:"roadNet",name:"高德路网图",layer:new AMap.TileLayer.RoadNet},{enable:!0,id:"object3D",name:"雷达扫描图",layer:object3Dlayer}]});map.addControl(t),map.setLayers(t.getEnabledLayers()),t.on("layerPropChanged",(function(e){e.props.enable&&(e.layer.id.includes("satellite")?(tickColor="#FFF",textColor="#FFF",drawTicks(),drawTickText()):e.layer.id.includes("tile")&&(tickColor="#000",textColor="#000",drawTicks(),drawTickText()))}))})),AMap.plugin(["AMap.ControlBar","AMap.Scale"],(function(){map.addControl(new AMap.ControlBar({position:{left:"-90px"}})),map.addControl(new AMap.Scale)})),$.post(urlGetRhiData,{"task id":task_id,content:"dates"},(function(e,t){currentDate=e.result[0].dateEnd,setDateRange(e.result[0].dateStart,e.result[0].dateEnd),$.post(urlGetRhiData,{"task id":task_id,content:"list","time start":e.result[0].dateEnd+" 00:00:00","time end":e.result[0].dateEnd+" 24:00:00"},(function(e,t){var a=document.getElementById("timeSeries");for(let t=0;t<e.result.length;t++)a.options.add(new Option(e.result[t].timestamp+""));$.ajax({type:"post",data:{"task id":task_id,content:"timedata",time:currentDate+" "+a.options[0].text},url:urlGetRhiData,beforeSend:function(){$("#myLoading").modal("show")},success:function(e){$("#myLoading").modal("hide"),addMapEvents(),prepareData(e),drawData=rdata.prr_A,createPie(position,drawData,resolution,rangeMax,horAng,verAngStart,verAngEnd,verAngStep,vMin,vMax,colorOpacity),createPieIndicator(),map.setZoomAndCenter(zoomLevel,position),PRA_data={z:drawData,x:timeat,y:height,zmin:vMin,zmax:vMax,type:"heatmap",transpose:!0,colorscale:createColorScale(11),colorbar:{thickness:15,xpad:5,showexponent:"last",exponentformat:"power"}},traceA={x:drawData[0].slice(layoutLineA.yaxis.range[0]/resolution*1e3,layoutLineA.yaxis.range[1]/resolution*1e3),y:height,mode:"lines",line:{color:"black",width:2}},layoutA.xaxis.range=[timeat[0],timeat[timeat.length-1]],layoutLineA.annotations[0].text=timeat[lineIndex],Plotly.newPlot("PRADiv",[PRA_data],layoutA,layoutConfig),Plotly.newPlot("lineADiv",[traceA],layoutLineA,layoutConfig),plotA.on("plotly_hover",plotHover),plotA.on("plotly_unhover",plotUnHover),document.getElementById("angleRange").textContent="扫描范围"+verAngStart+" - "+verAngEnd,document.getElementById("angleStep").textContent="扫描步长"+verAngStep,document.getElementById("angleVer").textContent="水平角度"+horAng,document.getElementById("timeStamp").textContent=timeat[0]+"至"+timeat[timeat.length-1]}})}))})),document.getElementById("playSpeed").oninput=function(){playSpeed=100*this.value}};
